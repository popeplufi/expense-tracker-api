<!DOCTYPE html>
<html>
<head>
    <title>JWT Frontend</title>
</head>
<body>

<h2>Login</h2>

<input type="text" id="username" placeholder="Username">
<input type="password" id="password" placeholder="Password">
<button onclick="login()">Login</button>

<hr>

<h3>Add Expense</h3>

<input type="text" id="category" placeholder="Category">
<input type="number" id="amount" placeholder="Amount">
<input type="date" id="date">
<button onclick="addExpense()">Add Expense</button>

<hr>

<button onclick="getExpenses()">Load Expenses</button>

<pre id="output"></pre>

<script>

let token = null;

async function login() {
    const response = await fetch("http://127.0.0.1:5001/api/login", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            username: document.getElementById("username").value,
            password: document.getElementById("password").value
        })
    });

    const data = await response.json();

    token = data.access_token;

    document.getElementById("output").textContent =
        "Logged in! Token stored.";
}

async function getExpenses() {
    const response = await fetch("http://127.0.0.1:5001/api/expenses", {
        headers: {
            "Authorization": "Bearer " + token
        }
    });

    const data = await response.json();

    document.getElementById("output").textContent =
        JSON.stringify(data, null, 2);
}

async function addExpense() {
    const response = await fetch("/api/expenses", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + token
        },
        body: JSON.stringify({
            category: document.getElementById("category").value,
            amount: parseFloat(document.getElementById("amount").value),
            date: document.getElementById("date").value
        })
    });

    const data = await response.json();

    document.getElementById("output").textContent =
        JSON.stringify(data, null, 2);
}

</script>

</body>
</html>
